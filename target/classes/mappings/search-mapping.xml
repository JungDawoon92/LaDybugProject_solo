<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SearchDAO">
	
	<select id="getsearch_reCount" resultType="int">
			SELECT COUNT(*) FROM RECIPE 
			WHERE recipe_nm LIKE CONCAT('%', #{searchValue}, '%') 
			OR recipe_info LIKE  CONCAT('%', #{searchValue}, '%') 
			OR recipe_category_kind LIKE CONCAT('%', #{searchValue}, '%') 
			OR recipe_category_ing LIKE CONCAT('%', #{searchValue}, '%') 
			OR recipe_category_how LIKE CONCAT('%', #{searchValue}, '%');

	</select>
	
	<select id="getsearch_inCount" resultType="int">
			SELECT COUNT(*)
			from ingredient R INNER join rank_sell_ingredient_list I
			on R.ingredient_no = I.ingredient_no
			WHERE ingredient_nm LIKE CONCAT('%', #{searchValue}, '%')  
			OR ingredient_categ LIKE CONCAT('%', #{searchValue}, '%')  
			OR ingredient_thumbName LIKE CONCAT('%', #{searchValue}, '%') ;
	</select>
	
	<select id="getsearch_reListList" parameterType="java.util.HashMap" resultType="division">
			SELECT * FROM RECIPE WHERE recipe_nm LIKE CONCAT('%', #{searchValue}, '%') OR recipe_info LIKE CONCAT('%', #{searchValue}, '%') OR recipe_category_kind LIKE CONCAT('%', #{searchValue}, '%') OR recipe_category_ing LIKE CONCAT('%', #{searchValue}, '%') OR recipe_category_how LIKE CONCAT('%', #{searchValue}, '%') ORDER BY RECIPE_CNT DESC  LIMIT #{startpage}, 2;
	</select>
	
	<select id="getsearch_inListList" parameterType="java.util.HashMap" resultType="divisionIn">
			SELECT R.ingredient_no, R.ingredient_nm, R.ingredient_categ, R.ingredient_price, R.ingredient_thumbName, R.ingredient_amt, I.ingredient_sell_sum
			from ingredient R INNER join rank_sell_ingredient_list I
			on R.ingredient_no = I.ingredient_no
			WHERE ingredient_nm LIKE CONCAT('%', #{searchValue}, '%') OR ingredient_categ LIKE CONCAT('%', #{searchValue}, '%') OR ingredient_thumbName LIKE CONCAT('%', #{searchValue}, '%')
			order by ingredient_sell_sum desc
			LIMIT #{startpage}, 5;
	</select>
	
	<insert id="search_add">
			INSERT INTO search VALUES (#{searchValue}, NOW(), 1)
	</insert>
	
	<select id="search_select" resultType="int">
			SELECT IFNULL(MAX(search_data_cnt),-1) FROM search WHERE search_data = #{search_data}
	</select>
	<update id="search_cnt_update">
			UPDATE search SET search_data_cnt = search_data_cnt+1 WHERE search_data = #{search_data}
	</update>
	
	<select id="searchInputAction" resultType="search">
		SELECT * FROM search WHERE search_data LIKE CONCAT(#{search_value}, '%') ORDER BY search_data_cnt DESC ;
	</select>

</mapper>
